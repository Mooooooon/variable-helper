import { parseVariableSyntax } from './parser.js';

/**
 * 测试变量解析功能
 */
export function testVariableParsing() {
  const testCases = [
    // 基础变量
    '@好感度 = 100',
    '@名字 = 小明',
    '你好，@名字！你的好感度是@好感度。',

    // 单个条件测试
    '@if(好感度 > 80): 角色会对用户表白',
    '@if(等级 >= 10): 你已经是高级玩家了！',
    '@if(名字 == 小明): 你好，小明同学！',

    // if-else测试
    '@if(好感度 > 90): 关系很好 @else: 关系一般',
    '@if(等级 >= 10): 高级玩家 @else: 新手玩家',

    // 单行elseif测试
    '@if(好感度 > 90): 恋人关系 @elseif(好感度 > 70): 好友关系 @else: 普通关系',
    '@if(等级 > 20): 专家 @elseif(等级 > 10): 老手 @elseif(等级 > 5): 新手 @else: 菜鸟',

    // 多行条件测试
    '@if(关系状态 == 恋人): 亲爱的，今天过得怎么样？ 想要一起吃晚饭吗？ @end',

    // 多行if-else测试
    '@if(好感度 > 80): 角色露出了甜美的笑容，看起来很开心。 今天真是美好的一天！ @else: 角色表情平淡，似乎心情一般。 @end',

    // 多行elseif测试
    '@if(健康值 > 80): 你感觉精力充沛，状态很好！ 可以进行任何活动。 @elseif(健康值 > 50): 你感觉还不错，但有些疲惫。 适当休息会更好。 @else: 你感觉很虚弱，需要立即休息。 不要勉强自己。 @end',

    // 复合测试
    '@好感度 = 100 @if(好感度 > 80): 角色会表白',

    // 分离的条件（避免冲突）
    '@等级 = 15',
    '@if(等级 >= 10): 你是高级玩家',
    '@if(生命值 <= 20): 状态不佳',

    // 嵌套测试（复杂场景）
    '@状态 = 战斗 @if(状态 == 战斗): @if(生命值 > 50): 继续战斗！ @else: 快逃跑！ @end @else: 平静的一天 @end',

    // 逻辑操作符测试
    '@if(好感度 > 80 && 等级 >= 10): 高好感度且高等级',
    '@if(生命值 <= 20 || 健康值 <= 30): 状态不佳',
    '@if(好感度 > 70 且 等级 > 5): 中文与操作符',
    '@if(生命值 < 50 或 健康值 < 40): 中文或操作符',
    '@if(!(好感度 < 50)): 非操作符测试',
    '@if(非(等级 < 5)): 中文非操作符',

    // 复杂逻辑组合
    '@if(好感度 > 80 && (等级 >= 10 || 健康值 > 70)): 复杂逻辑组合',
    '@if((生命值 > 50 && 魔法值 > 40) || 状态 == 无敌): 战斗准备完毕',
    '@if(!(生命值 <= 20 || 健康值 <= 30)): 状态良好',

    // 修复后的多行if-elseif-else测试
    '@好感度 = 85\n@if(好感度 > 95):\n恋人关系\n@elseif(好感度 > 80):\n好友关系\n@else:\n普通关系\n@end',
    '@生命值 = 30\n@if(生命值 <= 20):\n危险状态\n@elseif(生命值 <= 50):\n警告状态\n@else:\n良好状态\n@end',
    '@魔法值 = 80\n@if(魔法值 > 70):\n可以施法\n@elseif(魔法值 > 30):\n基础法术\n@else:\n无法施法\n@end',
  ];

  console.log('变量助手测试开始（完整else功能）：');
  console.log('=========================================');

  testCases.forEach((testCase, index) => {
    // 创建测试用的变量状态
    const testVariables = {
      好感度: '85',
      名字: '小明',
      等级: '15',
      生命值: '30',
      健康值: '60',
      魔法值: '45',
      关系状态: '好友',
      状态: '战斗',
    };
    const result = parseVariableSyntax(testCase, testVariables);
    console.log(`测试 ${index + 1}:`);
    console.log(`  输入: ${testCase}`);
    console.log(`  输出: ${result}`);
    console.log('');
  });

  // 显示提示
  toastr.success('测试结果已输出到控制台（F12）', '变量助手测试完成');
}
